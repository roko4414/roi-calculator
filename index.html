<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APG ROI Calculator</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      scrollbar-width: none !important;
      -ms-overflow-style: none !important;
    }

    *::-webkit-scrollbar {
      display: none !important;
      width: 0 !important;
      height: 0 !important;
    }

    html, body {
      overflow: hidden !important;
    }

    body {
      color: white;
      background-color: #0a0a0a;
    }

    .calculator-container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px 20px;
    }

    /* Header */
    .calculator-header {
      text-align: center;
      margin-bottom: 16px;
    }

    .calculator-header h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .calculator-header p {
      color: rgba(255,255,255,0.6);
      font-size: 13px;
    }

    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-bottom: 16px;
    }

    .step-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 20px;
      font-size: 12px;
      color: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .step-indicator:hover {
      background: rgba(255,255,255,0.08);
    }

    .step-indicator.active {
      background: rgba(125, 255, 0, 0.15);
      color: #7DFF00;
      border-color: rgba(125, 255, 0, 0.3);
    }

    .step-indicator.completed {
      background: rgba(125, 255, 0, 0.1);
      color: #7DFF00;
    }

    .step-number {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 11px;
    }

    .step-indicator.active .step-number,
    .step-indicator.completed .step-number {
      background: #7DFF00;
      color: #0a0a0a;
    }

    /* Panel */
    .panel {
      background: rgba(20, 20, 20, 0.9);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      min-height: 380px;
    }

    .panel-header {
      margin-bottom: 12px;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
    }

    .panel-subtitle {
      color: rgba(255,255,255,0.5);
      font-size: 12px;
      margin-top: 2px;
    }

    .step-content {
      display: none;
    }

    .step-content.active {
      display: block;
    }

    /* Category Dropdown */
    .category-dropdown {
      position: relative;
      margin-bottom: 12px;
    }

    .category-select {
      width: 100%;
      padding: 10px 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    .category-select:focus {
      outline: none;
      border-color: #7DFF00;
    }

    .category-select option {
      background: #1a1a1a;
      color: white;
    }

    /* Tools Grid */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 12px;
      min-height: 200px;
    }

    @media (max-width: 640px) {
      .tools-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .tool-card {
      padding: 10px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tool-card:hover {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.15);
    }

    .tool-card.selected {
      background: rgba(125, 255, 0, 0.1);
      border-color: #7DFF00;
    }

    .tool-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .tool-card-name {
      font-size: 13px;
      font-weight: 500;
    }

    .tool-card-check {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .tool-card.selected .tool-card-check {
      background: #7DFF00;
      border-color: #7DFF00;
      color: #0a0a0a;
    }

    .tool-card-tiers {
      display: flex;
      gap: 4px;
      margin-bottom: 6px;
    }

    .tier-btn {
      flex: 1;
      padding: 4px;
      border: 1px solid rgba(255,255,255,0.15);
      background: transparent;
      color: rgba(255,255,255,0.5);
      border-radius: 4px;
      cursor: pointer;
      font-size: 10px;
      transition: all 0.2s ease;
    }

    .tier-btn:hover {
      border-color: rgba(255,255,255,0.3);
    }

    .tier-btn.active {
      background: #7DFF00;
      border-color: #7DFF00;
      color: #0a0a0a;
      font-weight: 600;
    }

    .tool-card-users {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tool-card-users input {
      width: 45px;
      padding: 4px 6px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 4px;
      color: white;
      font-size: 11px;
      text-align: center;
    }

    .tool-card-users input:focus {
      outline: none;
      border-color: #7DFF00;
    }

    .tool-card-users span {
      font-size: 10px;
      color: rgba(255,255,255,0.4);
    }

    .tool-card-cost {
      font-size: 12px;
      color: #7DFF00;
      font-weight: 600;
      text-align: right;
      margin-top: 6px;
    }

    /* Selected Tools Summary */
    .selected-summary {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 10px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      min-height: 36px;
      align-items: center;
    }

    .selected-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: rgba(125, 255, 0, 0.15);
      border-radius: 12px;
      font-size: 11px;
      color: #7DFF00;
    }

    .selected-chip-remove {
      cursor: pointer;
      opacity: 0.7;
    }

    .selected-chip-remove:hover {
      opacity: 1;
    }

    .selected-placeholder {
      font-size: 12px;
      color: rgba(255,255,255,0.4);
    }

    /* Waste Items - Compact */
    .waste-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    @media (max-width: 640px) {
      .waste-grid {
        grid-template-columns: 1fr;
      }
    }

    .waste-item {
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .waste-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .waste-title {
      font-weight: 600;
      font-size: 13px;
    }

    .waste-cost {
      font-size: 14px;
      font-weight: 700;
      color: #7DFF00;
    }

    .waste-inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .input-label {
      font-size: 10px;
      color: rgba(255,255,255,0.5);
      min-width: 50px;
    }

    .slider {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      outline: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #7DFF00;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #7DFF00;
      cursor: pointer;
      border: none;
    }

    .slider-value {
      min-width: 40px;
      padding: 3px 6px;
      background: rgba(125, 255, 0, 0.15);
      color: #7DFF00;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-align: center;
    }

    /* AI Agents - Compact Grid */
    .ai-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    @media (max-width: 640px) {
      .ai-grid {
        grid-template-columns: 1fr;
      }
    }

    .ai-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .ai-toggle {
      width: 36px;
      height: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      cursor: pointer;
      position: relative;
      transition: background 0.2s ease;
      flex-shrink: 0;
    }

    .ai-toggle.active {
      background: #7DFF00;
    }

    .ai-toggle::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.2s ease;
    }

    .ai-toggle.active::after {
      transform: translateX(16px);
      background: #0a0a0a;
    }

    .ai-info {
      flex: 1;
      min-width: 0;
    }

    .ai-name {
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ai-savings {
      font-size: 11px;
      color: #7DFF00;
      font-weight: 600;
    }

    /* Results - Compact */
    .results-hero {
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(255, 107, 107, 0.2);
    }

    .results-hero-label {
      font-size: 13px;
      color: rgba(255,255,255,0.6);
      margin-bottom: 4px;
    }

    .results-hero-amount {
      font-size: 36px;
      font-weight: 800;
      color: #ff6b6b;
      line-height: 1;
      margin-bottom: 4px;
    }

    .results-hero-period {
      font-size: 14px;
      color: rgba(255,255,255,0.5);
    }

    .results-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 12px;
    }

    .results-card {
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.06);
      text-align: center;
    }

    .results-card-label {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 4px;
    }

    .results-card-value {
      font-size: 16px;
      font-weight: 700;
      color: #ff6b6b;
    }

    .results-card-value.green {
      color: #7DFF00;
    }

    .results-chart-container {
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .chart-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    #resultsChart {
      width: 100%;
      height: 140px;
    }

    /* CTA Panel */
    .cta-panel {
      text-align: center;
      padding: 24px 16px;
    }

    .cta-icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: rgba(125, 255, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      color: #7DFF00;
    }

    .cta-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .cta-subtitle {
      font-size: 14px;
      color: rgba(255,255,255,0.6);
      margin-bottom: 20px;
    }

    .cta-stats {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 20px;
    }

    .cta-stat-value {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .cta-stat-value.red {
      color: #ff6b6b;
    }

    .cta-stat-label {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
    }

    .cta-urgency {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.2);
      border-radius: 20px;
      margin-bottom: 20px;
      font-size: 13px;
      color: rgba(255,255,255,0.8);
    }

    .cta-urgency strong {
      color: #ff6b6b;
    }

    .cta-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 32px;
      background: #7DFF00;
      color: #0a0a0a;
      font-size: 15px;
      font-weight: 700;
      border-radius: 10px;
      text-decoration: none;
      transition: all 0.2s ease;
      margin-bottom: 12px;
    }

    .cta-button:hover {
      background: #6ee600;
      transform: translateY(-2px);
    }

    .cta-note {
      font-size: 11px;
      color: rgba(255,255,255,0.4);
    }

    /* Navigation */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .nav-btn {
      padding: 10px 24px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .nav-btn.secondary {
      background: rgba(255,255,255,0.08);
      color: white;
    }

    .nav-btn.secondary:hover {
      background: rgba(255,255,255,0.12);
    }

    .nav-btn.primary {
      background: #7DFF00;
      color: #0a0a0a;
    }

    .nav-btn.primary:hover {
      background: #6ee600;
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Running Total */
    .running-total {
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px;
      padding: 10px 16px;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .running-total-item {
      text-align: center;
    }

    .running-total-label {
      font-size: 10px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 2px;
    }

    .running-total-value {
      font-size: 15px;
      font-weight: 700;
      color: #7DFF00;
    }

    .running-total-value.red {
      color: #ff6b6b;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .step-indicator .step-label {
        display: none;
      }

      .results-cards {
        grid-template-columns: 1fr;
      }

      .cta-stats {
        flex-direction: column;
        gap: 12px;
      }
    }
  </style>
</head>
<body>
<div class="calculator-container">
  <div class="calculator-header">
    <h1>APG ROI Calculator</h1>
    <p>Calculate your losses</p>
  </div>

  <div class="progress-steps">
    <div class="step-indicator active" data-step="1">
      <span class="step-number">1</span>
      <span class="step-label">SaaS Tools</span>
    </div>
    <div class="step-indicator" data-step="2">
      <span class="step-number">2</span>
      <span class="step-label">Inefficiencies</span>
    </div>
    <div class="step-indicator" data-step="3">
      <span class="step-number">3</span>
      <span class="step-label">AI Enablement</span>
    </div>
    <div class="step-indicator" data-step="4">
      <span class="step-number">4</span>
      <span class="step-label">Your Results</span>
    </div>
    <div class="step-indicator" data-step="5">
      <span class="step-number">5</span>
      <span class="step-label">Get Quote</span>
    </div>
  </div>

  <!-- Step 1: SaaS Tools -->
  <div class="step-content active" id="step1">
    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Select Your SaaS Tools</h2>
        <p class="panel-subtitle">Choose a category and select the tools your team uses</p>
      </div>

      <div class="category-dropdown">
        <select class="category-select" id="categorySelect">
          <option value="">Choose a category...</option>
        </select>
      </div>

      <div class="tools-grid" id="toolsGrid">
        <div style="grid-column: 1/-1; text-align: center; color: rgba(255,255,255,0.4); padding: 40px; font-size: 13px;">
          Select a category above to see available tools
        </div>
      </div>

      <div class="selected-summary" id="selectedSummary">
        <span class="selected-placeholder">No tools selected yet</span>
      </div>
    </div>
  </div>

  <!-- Step 2: Inefficiency Waste -->
  <div class="step-content" id="step2">
    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Inefficiency Waste</h2>
        <p class="panel-subtitle">Estimate hours your team spends on these activities</p>
      </div>
      <div class="waste-grid" id="wasteGrid"></div>
    </div>
  </div>

  <!-- Step 3: AI Enablement -->
  <div class="step-content" id="step3">
    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">AI Enablement Opportunities</h2>
        <p class="panel-subtitle">Toggle AI agents that could automate your workflows</p>
      </div>
      <div class="ai-grid" id="aiGrid"></div>
    </div>
  </div>

  <!-- Step 4: Results -->
  <div class="step-content" id="step4">
    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Your Results</h2>
        <p class="panel-subtitle">Here's what your current setup is costing you</p>
      </div>

      <div class="results-hero">
        <div class="results-hero-label">You're losing</div>
        <div class="results-hero-amount" id="resultsYearlyWaste">$0</div>
        <div class="results-hero-period">per year</div>
      </div>

      <div class="results-cards">
        <div class="results-card">
          <div class="results-card-label">SaaS Tools</div>
          <div class="results-card-value" id="resultsToolsCost">$0/mo</div>
        </div>
        <div class="results-card">
          <div class="results-card-label">Inefficiency</div>
          <div class="results-card-value" id="resultsWasteCost">$0/mo</div>
        </div>
        <div class="results-card">
          <div class="results-card-label">AI Savings</div>
          <div class="results-card-value green" id="resultsAISavings">+$0/mo</div>
        </div>
      </div>

      <div class="results-chart-container">
        <h3 class="chart-title">12-Month Cost Projection</h3>
        <canvas id="resultsChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Step 5: CTA -->
  <div class="step-content" id="step5">
    <div class="panel cta-panel">
      <div class="cta-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
      </div>
      <h2 class="cta-title">Let's Fix This Together</h2>
      <p class="cta-subtitle">Book a free consultation to eliminate your waste</p>

      <div class="cta-stats">
        <div class="cta-stat">
          <div class="cta-stat-value red" id="ctaMonthlyWaste">$0</div>
          <div class="cta-stat-label">Monthly Waste</div>
        </div>
        <div class="cta-stat">
          <div class="cta-stat-value red" id="ctaYearlyWaste">$0</div>
          <div class="cta-stat-label">Yearly Waste</div>
        </div>
      </div>

      <div class="cta-urgency">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2h12M6 22h12M12 6v4l2 2M6 6a6 6 0 0 0 6 6 6 6 0 0 0 6-6M6 18a6 6 0 0 1 6-6 6 6 0 0 1 6 6"></path></svg>
        <span>Every month you wait costs you <strong id="ctaUrgencyAmount">$0</strong></span>
      </div>

      <a href="#" class="cta-button">
        Book Your Free Consultation
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </a>

      <p class="cta-note">No commitment required. We'll review your results and show you a custom solution.</p>
    </div>
  </div>

  <div class="nav-buttons">
    <button class="nav-btn secondary" id="prevBtn" disabled>Back</button>
    <button class="nav-btn primary" id="nextBtn">Next Step</button>
  </div>

  <div class="running-total">
    <div class="running-total-item">
      <div class="running-total-label">SaaS Cost/mo</div>
      <div class="running-total-value red" id="runningToolsCost">$0</div>
    </div>
    <div class="running-total-item">
      <div class="running-total-label">Inefficiency/mo</div>
      <div class="running-total-value red" id="runningWasteCost">$0</div>
    </div>
    <div class="running-total-item">
      <div class="running-total-label">AI Savings/mo</div>
      <div class="running-total-value" id="runningAICost">$0</div>
    </div>
    <div class="running-total-item">
      <div class="running-total-label">Total Waste/mo</div>
      <div class="running-total-value red" id="runningTotalWaste">$0</div>
    </div>
  </div>
</div>

<script>
// DATA
const toolsData = {
  "CRM & Sales": [
    { name: "HubSpot", tiers: [15, 50, 125] },
    { name: "Salesforce", tiers: [25, 75, 150] },
    { name: "Pipedrive", tiers: [14, 29, 49] },
    { name: "Zoho CRM", tiers: [14, 23, 40] },
    { name: "Copper", tiers: [29, 69, 134] },
    { name: "Close", tiers: [29, 69, 129] }
  ],
  "Project Management": [
    { name: "Asana", tiers: [11, 25, 50] },
    { name: "Monday.com", tiers: [9, 12, 19] },
    { name: "ClickUp", tiers: [7, 12, 19] },
    { name: "Trello", tiers: [5, 10, 18] },
    { name: "Wrike", tiers: [10, 25, 50] },
    { name: "Smartsheet", tiers: [9, 19, 39] }
  ],
  "Form Tools": [
    { name: "Typeform", tiers: [25, 50, 83] },
    { name: "Jotform", tiers: [34, 39, 99] },
    { name: "SurveyMonkey", tiers: [25, 35, 75] },
    { name: "Formstack", tiers: [50, 83, 208] },
    { name: "Cognito Forms", tiers: [10, 15, 25] },
    { name: "Wufoo", tiers: [14, 29, 74] }
  ],
  "Social Media": [
    { name: "Buffer", tiers: [6, 12, 120] },
    { name: "Hootsuite", tiers: [99, 249, 739] },
    { name: "Later", tiers: [18, 40, 80] },
    { name: "Sprout Social", tiers: [249, 399, 499] },
    { name: "SocialBee", tiers: [29, 49, 99] },
    { name: "Planoly", tiers: [13, 23, 43] }
  ],
  "Dashboards & BI": [
    { name: "Tableau", tiers: [70, 70, 70] },
    { name: "Power BI", tiers: [10, 20, 20] },
    { name: "Metabase", tiers: [0, 85, 85] },
    { name: "Databox", tiers: [47, 135, 231] },
    { name: "Klipfolio", tiers: [49, 199, 799] }
  ],
  "Support & Help Desk": [
    { name: "Zendesk", tiers: [19, 49, 99] },
    { name: "Freshdesk", tiers: [15, 49, 79] },
    { name: "Help Scout", tiers: [20, 40, 65] },
    { name: "Intercom", tiers: [74, 119, 219] },
    { name: "Front", tiers: [19, 49, 99] },
    { name: "Groove", tiers: [12, 20, 40] }
  ],
  "Invoicing & Accounting": [
    { name: "QuickBooks", tiers: [30, 60, 90] },
    { name: "Xero", tiers: [13, 37, 70] },
    { name: "FreshBooks", tiers: [17, 30, 55] },
    { name: "Zoho Books", tiers: [15, 40, 60] }
  ],
  "Time Tracking": [
    { name: "Toggl Track", tiers: [10, 20, 30] },
    { name: "Harvest", tiers: [12, 12, 12] },
    { name: "Clockify", tiers: [0, 5, 10] },
    { name: "Timely", tiers: [9, 16, 22] },
    { name: "Hubstaff", tiers: [7, 10, 20] }
  ],
  "Communication": [
    { name: "Slack", tiers: [7, 13, 15] },
    { name: "Microsoft Teams", tiers: [6, 13, 22] },
    { name: "Zoom", tiers: [13, 17, 25] },
    { name: "Google Workspace", tiers: [6, 12, 18] }
  ],
  "Automation": [
    { name: "Zapier", tiers: [20, 49, 299] },
    { name: "Make", tiers: [9, 16, 29] },
    { name: "n8n", tiers: [0, 20, 50] }
  ],
  "Document Management": [
    { name: "Google Drive", tiers: [6, 12, 18] },
    { name: "Dropbox", tiers: [12, 18, 24] },
    { name: "OneDrive", tiers: [6, 13, 22] },
    { name: "Box", tiers: [5, 15, 25] }
  ],
  "E-signature": [
    { name: "DocuSign", tiers: [10, 25, 40] },
    { name: "PandaDoc", tiers: [19, 49, 65] },
    { name: "HelloSign", tiers: [15, 25, 40] },
    { name: "SignNow", tiers: [8, 15, 25] }
  ],
  "Scheduling": [
    { name: "Calendly", tiers: [8, 12, 16] },
    { name: "Acuity", tiers: [16, 27, 49] }
  ],
  "Marketing": [
    { name: "Mailchimp", tiers: [13, 20, 350] },
    { name: "Constant Contact", tiers: [12, 35, 80] },
    { name: "ConvertKit", tiers: [9, 25, 50] }
  ],
  "Collaboration & Wikis": [
    { name: "Notion", tiers: [8, 15, 20] },
    { name: "Confluence", tiers: [6, 11, 22] },
    { name: "Coda", tiers: [10, 30, 50] },
    { name: "Slite", tiers: [8, 13, 15] }
  ],
  "HR & Payroll": [
    { name: "Gusto", tiers: [40, 80, 120] },
    { name: "Rippling", tiers: [8, 16, 25] }
  ]
};

const wasteCategories = [
  { id: "ductTape", name: "Duct-tape Labor", defaultHours: 10, defaultRate: 40 },
  { id: "emailArchaeology", name: "Email Archaeology", defaultHours: 10, defaultRate: 40 },
  { id: "spreadsheetHell", name: "Spreadsheet Hell", defaultHours: 10, defaultRate: 40 },
  { id: "fileHunting", name: "File Hunting", defaultHours: 10, defaultRate: 40 },
  { id: "statusMeetings", name: "Status Meetings", defaultHours: 10, defaultRate: 40 }
];

const aiAgents = [
  { id: "contextAgent", name: "Company Context Agent", prevHours: 4, newHours: 0.5, rate: 50 },
  { id: "customerService", name: "Customer Service AI", prevHours: 6, newHours: 2, rate: 50 },
  { id: "salesAssistant", name: "Sales Assistant", prevHours: 5, newHours: 1, rate: 50 },
  { id: "financialInsights", name: "Financial Insights", prevHours: 4, newHours: 1, rate: 50 },
  { id: "proposalGenerator", name: "Proposal Generator", prevHours: 5, newHours: 1.5, rate: 50 },
  { id: "projectKickoff", name: "Project Kickoff Agent", prevHours: 4, newHours: 1, rate: 50 },
  { id: "timesheetApproval", name: "Timesheet Approval", prevHours: 3, newHours: 1.5, rate: 50 },
  { id: "clientOnboarding", name: "Client Onboarding", prevHours: 4, newHours: 1, rate: 50 },
  { id: "semanticSearch", name: "Semantic Search", prevHours: 3, newHours: 1, rate: 50 },
  { id: "meetingPrep", name: "Meeting Prep Agent", prevHours: 4, newHours: 1, rate: 50 }
];

// STATE
let currentStep = 1;
let selectedTools = {};
let wasteInputs = {};
let selectedAIAgents = {};
let currentCategory = '';

// INITIALIZATION
document.addEventListener('DOMContentLoaded', function() {
  initializeCategoryDropdown();
  initializeWasteGrid();
  initializeAIGrid();
  initializeNavigation();
  calculateTotals();
});

function initializeCategoryDropdown() {
  const select = document.getElementById('categorySelect');
  Object.keys(toolsData).forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category;
    select.appendChild(option);
  });

  select.addEventListener('change', (e) => {
    currentCategory = e.target.value;
    renderToolsGrid();
  });
}

function renderToolsGrid() {
  const grid = document.getElementById('toolsGrid');

  if (!currentCategory) {
    grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; color: rgba(255,255,255,0.4); padding: 40px; font-size: 13px;">
      Select a category above to see available tools
    </div>`;
    return;
  }

  const tools = toolsData[currentCategory];
  grid.innerHTML = tools.map(tool => {
    const toolId = `${currentCategory}-${tool.name}`.replace(/\s+/g, '-').toLowerCase();
    const state = selectedTools[toolId] || { selected: false, tier: 1, users: 5 };
    const cost = state.selected ? tool.tiers[state.tier - 1] * state.users : 0;

    return `
      <div class="tool-card ${state.selected ? 'selected' : ''}" data-tool-id="${toolId}">
        <div class="tool-card-header">
          <span class="tool-card-name">${tool.name}</span>
          <span class="tool-card-check">${state.selected ? '✓' : ''}</span>
        </div>
        <div class="tool-card-tiers">
          ${tool.tiers.map((price, i) => `
            <button class="tier-btn ${state.tier === i + 1 ? 'active' : ''}" data-tier="${i + 1}">$${price}</button>
          `).join('')}
        </div>
        <div class="tool-card-users">
          <input type="number" value="${state.users}" min="1" max="500" data-tool="${toolId}">
          <span>users</span>
        </div>
        <div class="tool-card-cost">${state.selected ? '$' + cost + '/mo' : '-'}</div>
      </div>
    `;
  }).join('');

  // Store tool data
  tools.forEach(tool => {
    const toolId = `${currentCategory}-${tool.name}`.replace(/\s+/g, '-').toLowerCase();
    if (!selectedTools[toolId]) {
      selectedTools[toolId] = { name: tool.name, tiers: tool.tiers, selected: false, tier: 1, users: 5 };
    }
  });

  // Event listeners
  grid.querySelectorAll('.tool-card').forEach(card => {
    card.addEventListener('click', (e) => {
      if (e.target.classList.contains('tier-btn') || e.target.tagName === 'INPUT') return;
      const toolId = card.dataset.toolId;
      selectedTools[toolId].selected = !selectedTools[toolId].selected;
      renderToolsGrid();
      updateSelectedSummary();
      calculateTotals();
    });
  });

  grid.querySelectorAll('.tier-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const card = btn.closest('.tool-card');
      const toolId = card.dataset.toolId;
      selectedTools[toolId].tier = parseInt(btn.dataset.tier);
      selectedTools[toolId].selected = true;
      renderToolsGrid();
      updateSelectedSummary();
      calculateTotals();
    });
  });

  grid.querySelectorAll('.tool-card-users input').forEach(input => {
    input.addEventListener('click', (e) => e.stopPropagation());
    input.addEventListener('change', (e) => {
      const toolId = input.dataset.tool;
      selectedTools[toolId].users = parseInt(input.value) || 1;
      renderToolsGrid();
      updateSelectedSummary();
      calculateTotals();
    });
  });
}

function updateSelectedSummary() {
  const summary = document.getElementById('selectedSummary');
  const selected = Object.entries(selectedTools).filter(([_, t]) => t.selected);

  if (selected.length === 0) {
    summary.innerHTML = '<span class="selected-placeholder">No tools selected yet</span>';
    return;
  }

  summary.innerHTML = selected.map(([id, tool]) => {
    const cost = tool.tiers[tool.tier - 1] * tool.users;
    return `
      <div class="selected-chip">
        ${tool.name} ($${cost})
        <span class="selected-chip-remove" data-tool="${id}">×</span>
      </div>
    `;
  }).join('');

  summary.querySelectorAll('.selected-chip-remove').forEach(btn => {
    btn.addEventListener('click', () => {
      selectedTools[btn.dataset.tool].selected = false;
      renderToolsGrid();
      updateSelectedSummary();
      calculateTotals();
    });
  });
}

function initializeWasteGrid() {
  const grid = document.getElementById('wasteGrid');

  wasteCategories.forEach(waste => {
    if (!wasteInputs[waste.id]) {
      wasteInputs[waste.id] = { hours: waste.defaultHours, rate: waste.defaultRate };
    }
    const cost = wasteInputs[waste.id].hours * wasteInputs[waste.id].rate * 4;

    const item = document.createElement('div');
    item.className = 'waste-item';
    item.innerHTML = `
      <div class="waste-header">
        <span class="waste-title">${waste.name}</span>
        <span class="waste-cost" id="waste-cost-${waste.id}">$${formatNumber(cost)}/mo</span>
      </div>
      <div class="waste-inputs">
        <div class="input-row">
          <span class="input-label">Hours/wk</span>
          <input type="range" class="slider" min="0" max="40" value="${wasteInputs[waste.id].hours}" data-waste="${waste.id}" data-type="hours">
          <div class="slider-value" id="waste-hours-${waste.id}">${wasteInputs[waste.id].hours}h</div>
        </div>
        <div class="input-row">
          <span class="input-label">Rate/hr</span>
          <input type="range" class="slider" min="20" max="150" value="${wasteInputs[waste.id].rate}" data-waste="${waste.id}" data-type="rate">
          <div class="slider-value" id="waste-rate-${waste.id}">$${wasteInputs[waste.id].rate}</div>
        </div>
      </div>
    `;
    grid.appendChild(item);
  });

  grid.querySelectorAll('.slider').forEach(slider => {
    slider.addEventListener('input', () => {
      const wasteId = slider.dataset.waste;
      const type = slider.dataset.type;
      wasteInputs[wasteId][type] = parseInt(slider.value);

      if (type === 'hours') {
        document.getElementById(`waste-hours-${wasteId}`).textContent = slider.value + 'h';
      } else {
        document.getElementById(`waste-rate-${wasteId}`).textContent = '$' + slider.value;
      }

      const cost = wasteInputs[wasteId].hours * wasteInputs[wasteId].rate * 4;
      document.getElementById(`waste-cost-${wasteId}`).textContent = '$' + formatNumber(cost) + '/mo';
      calculateTotals();
    });
  });
}

function initializeAIGrid() {
  const grid = document.getElementById('aiGrid');

  aiAgents.forEach(agent => {
    if (selectedAIAgents[agent.id] === undefined) {
      selectedAIAgents[agent.id] = true;
    }

    const isActive = selectedAIAgents[agent.id];
    const savings = (agent.prevHours - agent.newHours) * agent.rate * 4;

    const item = document.createElement('div');
    item.className = 'ai-item';
    item.innerHTML = `
      <div class="ai-toggle ${isActive ? 'active' : ''}" data-agent="${agent.id}"></div>
      <div class="ai-info">
        <div class="ai-name">${agent.name}</div>
        <div class="ai-savings">${isActive ? '$' + formatNumber(savings) + '/mo' : 'Disabled'}</div>
      </div>
    `;
    grid.appendChild(item);
  });

  grid.querySelectorAll('.ai-toggle').forEach(toggle => {
    toggle.addEventListener('click', () => {
      const agentId = toggle.dataset.agent;
      selectedAIAgents[agentId] = !selectedAIAgents[agentId];
      toggle.classList.toggle('active');

      const agent = aiAgents.find(a => a.id === agentId);
      const savings = (agent.prevHours - agent.newHours) * agent.rate * 4;
      const savingsEl = toggle.nextElementSibling.querySelector('.ai-savings');
      savingsEl.textContent = selectedAIAgents[agentId] ? '$' + formatNumber(savings) + '/mo' : 'Disabled';

      calculateTotals();
    });
  });
}

function initializeNavigation() {
  document.getElementById('prevBtn').addEventListener('click', () => {
    if (currentStep > 1) goToStep(currentStep - 1);
  });

  document.getElementById('nextBtn').addEventListener('click', () => {
    if (currentStep < 5) {
      goToStep(currentStep + 1);
    } else {
      goToStep(1);
    }
  });

  document.querySelectorAll('.step-indicator').forEach(indicator => {
    indicator.addEventListener('click', () => {
      goToStep(parseInt(indicator.dataset.step));
    });
  });
}

function goToStep(step) {
  currentStep = step;

  document.querySelectorAll('.step-indicator').forEach(indicator => {
    const s = parseInt(indicator.dataset.step);
    indicator.classList.remove('active', 'completed');
    if (s === currentStep) indicator.classList.add('active');
    else if (s < currentStep) indicator.classList.add('completed');
  });

  document.querySelectorAll('.step-content').forEach(content => {
    content.classList.remove('active');
  });
  document.getElementById(`step${currentStep}`).classList.add('active');

  document.getElementById('prevBtn').disabled = currentStep === 1;
  document.getElementById('nextBtn').textContent = currentStep === 5 ? 'Start Over' : 'Next Step';

  if (currentStep === 4) updateResultsPage();
  if (currentStep === 5) updateCTAPage();

  lastSentHeight = 0;
  setTimeout(updateHeight, 50);
  window.parent.postMessage({ type: 'scrollToTop' }, '*');
}

function calculateTotals() {
  let toolsCost = 0;
  Object.values(selectedTools).forEach(tool => {
    if (tool.selected) {
      toolsCost += tool.tiers[tool.tier - 1] * tool.users;
    }
  });

  let wasteCost = 0;
  Object.values(wasteInputs).forEach(waste => {
    wasteCost += waste.hours * waste.rate * 4;
  });

  let aiCost = 0;
  aiAgents.forEach(agent => {
    if (selectedAIAgents[agent.id]) {
      aiCost += (agent.prevHours - agent.newHours) * agent.rate * 4;
    }
  });

  const totalWaste = toolsCost + wasteCost;

  document.getElementById('runningToolsCost').textContent = '$' + formatNumber(toolsCost);
  document.getElementById('runningWasteCost').textContent = '$' + formatNumber(wasteCost);
  document.getElementById('runningAICost').textContent = '$' + formatNumber(aiCost);
  document.getElementById('runningTotalWaste').textContent = '$' + formatNumber(totalWaste);

  return { toolsCost, wasteCost, aiCost, totalWaste };
}

function updateResultsPage() {
  const { toolsCost, wasteCost, aiCost, totalWaste } = calculateTotals();
  document.getElementById('resultsYearlyWaste').textContent = '$' + formatNumber(totalWaste * 12);
  document.getElementById('resultsToolsCost').textContent = '$' + formatNumber(toolsCost) + '/mo';
  document.getElementById('resultsWasteCost').textContent = '$' + formatNumber(wasteCost) + '/mo';
  document.getElementById('resultsAISavings').textContent = '+$' + formatNumber(aiCost) + '/mo';
  drawResultsChart(totalWaste);
}

function updateCTAPage() {
  const { totalWaste } = calculateTotals();
  document.getElementById('ctaMonthlyWaste').textContent = '$' + formatNumber(totalWaste);
  document.getElementById('ctaYearlyWaste').textContent = '$' + formatNumber(totalWaste * 12);
  document.getElementById('ctaUrgencyAmount').textContent = '$' + formatNumber(totalWaste);
}

function drawResultsChart(monthlyWaste) {
  const canvas = document.getElementById('resultsChart');
  if (!canvas) return;

  const ctx = canvas.getContext('2d');
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width - 24;
  canvas.height = 140;

  const width = canvas.width;
  const height = canvas.height;
  const padding = { top: 25, right: 30, bottom: 25, left: 50 };
  const chartWidth = width - padding.left - padding.right;
  const chartHeight = height - padding.top - padding.bottom;

  const maxValue = monthlyWaste * 12;
  const yScale = chartHeight / maxValue;
  const xScale = chartWidth / 12;

  ctx.clearRect(0, 0, width, height);

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.1)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 3; i++) {
    const y = padding.top + (chartHeight / 3) * i;
    ctx.beginPath();
    ctx.moveTo(padding.left, y);
    ctx.lineTo(width - padding.right, y);
    ctx.stroke();

    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '10px Inter';
    ctx.textAlign = 'right';
    const value = maxValue - (maxValue / 3) * i;
    ctx.fillText('$' + formatNumber(value), padding.left - 8, y + 3);
  }

  // X labels
  ctx.textAlign = 'center';
  for (let m = 0; m <= 12; m += 4) {
    ctx.fillText('M' + m, padding.left + m * xScale, height - 8);
  }

  // Area
  ctx.beginPath();
  ctx.moveTo(padding.left, padding.top + chartHeight);
  for (let m = 0; m <= 12; m++) {
    const x = padding.left + m * xScale;
    const y = padding.top + chartHeight - (monthlyWaste * m * yScale);
    ctx.lineTo(x, y);
  }
  ctx.lineTo(padding.left + 12 * xScale, padding.top + chartHeight);
  ctx.closePath();
  ctx.fillStyle = 'rgba(255, 107, 107, 0.2)';
  ctx.fill();

  // Line
  ctx.beginPath();
  ctx.strokeStyle = '#ff6b6b';
  ctx.lineWidth = 2;
  for (let m = 0; m <= 12; m++) {
    const x = padding.left + m * xScale;
    const y = padding.top + chartHeight - (monthlyWaste * m * yScale);
    if (m === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();

  // End point
  const endX = padding.left + 12 * xScale;
  const endY = padding.top + chartHeight - (maxValue * yScale);
  ctx.beginPath();
  ctx.arc(endX, endY, 4, 0, Math.PI * 2);
  ctx.fillStyle = '#ff6b6b';
  ctx.fill();

  ctx.fillStyle = '#ff6b6b';
  ctx.font = 'bold 10px Inter';
  ctx.fillText('$' + formatNumber(maxValue), endX, endY - 10);
}

function formatNumber(num) {
  return Math.round(num).toLocaleString('en-US');
}

// Height communication
let lastSentHeight = 0;
let heightUpdateTimeout = null;

function updateHeight() {
  try {
    const container = document.querySelector('.calculator-container');
    const height = container ? container.offsetHeight + 32 : 700;
    if (Math.abs(height - lastSentHeight) < 10) return;
    lastSentHeight = height;
    window.parent.postMessage({ type: 'resize', height: height }, '*');
  } catch (error) {}
}

function updateHeightDelayed() {
  if (heightUpdateTimeout) clearTimeout(heightUpdateTimeout);
  heightUpdateTimeout = setTimeout(updateHeight, 100);
}

updateHeight();
setTimeout(updateHeight, 50);
setTimeout(updateHeight, 200);

window.addEventListener('resize', updateHeightDelayed);
window.addEventListener('load', () => {
  updateHeight();
  setTimeout(updateHeight, 100);
});

const observer = new MutationObserver(updateHeightDelayed);
observer.observe(document.body, {
  childList: true,
  subtree: true,
  attributes: true,
  attributeFilter: ['style', 'class']
});
</script>
</body>
</html>
